# 计算机 📚

## 计算机网络原理和因特网

### 网络概述

#### 网络定义及分类

1、计算机网络 = 计算机 + 通信技术

2、计算机网络五大基本元素

主机（用户终端/服务器）、交换节点、通信链路、拓扑结构(计算机网络物理布局)、通信软件

3、计算机网络分类

- 按覆盖范围：广域网、城域网、局域网
- 按传输方式： - 广播发送（以太网、wifi），一条线，只有一个通信信道共享介质。（信道分配问题？静态/动态分配） - 单播：即使消息已被接收，还是会走遍所有节点 - 广播：广播地址 - 组播：组播地址、组成员 - 点-点传输。拓扑结构：树型、环型、星状。(路由器) - 单播：多跳传输 - 广播：多跳传输 - 组播：多跳传输
  按交换技术：电路交换、包交换

4、内容

<img :src="$withBase('/cs.jpg')" alt="cs">

#### 网络核心技术

1、电话网络与电路交换。(针对每对用户的电路建立)

交换机如何为每对通信节点建立电路？
多条电路如何共享一条高容量链路？

优点：实时性好、带宽保障、不存在信道访问延迟
缺点：长距离通讯建立连接时间长、扩展性差(硬件成本)

2、包交换技术。(针对每个包存储-转发)

存储-转发：交换节点接收存储包，交换机根据包目标地址转发
包分组：大小固定的数据块
报文：用户发送的原始数据

优点：带宽资源利用率有效、灵活
缺点：丢包、排队延迟(与流量成正比)

3、性能评估

丢包率：负载、介质
处理存储-转发时延：发送、次数
传播时延：距离、介质
吞吐量：瓶颈链路带宽

#### 网络结构 TCP/IP 协议栈

1、分层模型

- 为什么分层？

分而治之：简化问题、定位问题

- 层次结构

每一层目的：向上层提供服务、屏蔽实现细节

- 五层

物理层：0 和 1 的电信号
链接层：以太网协议、数据包的定义
网络层：IP 地址
传输层：端口、TCP/UDP
应用层：HTTP、FTP、IMAP、DNS

- OSI 定义了网络互连的七层框架（物理层、数据链路层、网络层、传输层、会话层、表示层、应用层），即 ISO 开放互连系统参考模型

### 通信概述

#### 数据与传输介质

1、信道通信方式

- 单工通信：光纤、广播电视电台

- 半双工通信：对讲机

- 全双工通信

2、信号+传输+数据

数据：模拟数据（语音图像连续变化的）、数字数据（文本和数据）
信号：连续信号，连续可变电压表示（模拟）、离散信号，01 特定电压表示（数字）

有些传输介质只能传输模拟信号，如电话线。

两者转换：调制解调

3、有线传输介质

电话线/双绞线、有线电视电缆、光纤、无线电

引导性介质（有线介质）：双绞线、同轴电缆、光纤（单多模）、电(力)线。====铜、光子
非引导性介质（无线介质）：电磁波

网线：
<img :src="$withBase('/wx.jpg')" alt="wx">

光电转换器：电子信号<->光信号

绝不能拿肉眼看光纤！！！

4、无线传输介质

无线电：穿墙、不受雨雪
微波：地面微波、卫星微波
红外：不能穿透

5、信道与容量

#### 数据编码技术

1、调制解调技术

数字信号与模拟信号：调制解调器

基于振幅的传输调制方式：调幅 AM
基于频率的传输调制方式：调频 FM
基于相位的传输调制方式：调相 PM

2、数字数据编码解码

你能听到的都是模拟信号，数字信号只有机器能懂。

数字化：将模拟信号转换成数字信号。

数字化过程详解：模拟数据（采样定理-量化-编码为二进制比特码组）--数字传输-- （解码-滤波器）模拟信号

3、数字数据编码：不归零、不归零反转、曼彻斯特、差分曼氏

#### 多路复用

1、充分利用信道传输能力。（多路复用器、多路分用器）

2、关键：把多路信号汇合到一条信道后，在接收端必须正确的分割出各种信号。

3、

- 频分多路复用技术【各走各道互不干扰】（每个数据信号被调制到具有不同频率的载波上）
- 时分多路复用技术【互相尊重共同前进】（以时间作为分割信号依据，每个信号在时间上交替出现，使得在一个传输链路上传输多个数字信号）。需要收发端旋转开关必须严格同步，即同频同相。
- 波分多路复用技术
- 码分多路复用技术

### 数据链路层

#### 概述

1、网络层通过接口把数据包交给链路层

2、链路层把包 装在本层协议规定的格式中（帧）

网卡物理层针对具体介质产生相应信号完成单个比特的传输

数据帧 Frame：在数据链路上交换数据的单位

包/分组 Packet：

3、数据链路层：负责整条路径上点-点数据传输、网络层与物理介质的桥梁、为网络层存储转发提供支持

#### 流量控制

解决发送方接收方能力不匹配问题，用来确保发送实体发出的数据不会覆盖接收方已接受的数据。

停等式控制：发帧-收帧-确认帧（ACK）-发下一个。（长距离效率低）

- 为什么数据分为许多小帧原因：
  - 接收缓冲区大小受限制
  - 传输数据越长出错可能性越大
  - 一个节点不能占用信道时间过长

滑动窗口流量控制：利用窗口控制连续发送的数据量。

<img :src="$withBase('/hdck.jpg')" alt="hdck">

窗口操作：在连续发送的情况下，利用模数运算让序号循环使用，但要在收发两端进行适当控制。

条件：两个节点全双工连接、收发双方为 n 个帧分配缓冲区、每个数据帧拥有一个序号

#### 差错控制（帧传输出现错误）（正确接收、检错能力、纠错能力）

1、错误情况：数据帧丢失、确认帧丢失（死等）、数据帧破坏

2、差错控制：对传输数据错误检测，并在发现错误时恰当处理。【差错检测、肯定确认、超时重发、否定确认与重发】

3、自动重发检错(ARQ)：纠错编码+校验码。 - 停等式 ARQ： - 滑动窗口式差错检测 ARQ：

4、奇偶校验码、循环校验码

#### 802.3 协议、802.11 协议

802.3：不可靠无连接数据传输服务

<img :src="$withBase('/8023.jpg')" alt="8023">

802.11：

<img :src="$withBase('/80211.jpg')" alt="80211">

### 网络层

#### 协议

1、TCP/IP 协议栈如下：

应用层
^
|
传输层 ————传输层报文（上层数据）
^
|
网络层 ————网络层包（IP 头+有效载荷）
^
|
链路层（802.3/802.11）————链路层帧（帧头+有效载荷）

2、网络层服务分：面向连接可靠、面向连接不可靠、可靠无连接、不可靠无连接

因特网提供的是最简单的不可靠的无连接服务。

3、因特网网络协议（沙漏模型 ⏳）

- 主协议：IP 互联网协议
- 包传递：ICMP 控制报文协议、ARP 地址解析协议
- 地址管理：DHCP 动态地址分配、NAT 地址转换
- 路由计算：OSPF 最短路径协议、BGP 边界网关协议

4、存储转发技术与点-点传输
网络层负责包的前进方向、链路层负责包的实际传输
一次端-端的网络层通信、由一系列点-点传输组成

5、IP 协议：为上层用户提供路尽力而为的无连接不可靠包传递服务

#### IP 协议

MAC 地址：也叫物理地址、硬件地址或链路地址，由网络设备制造商生产时写在硬件内部。不利网络寻址

IP 地址：其层次结构使得路由算法针对网络路由成为可能

点分十进制：将 32 位中每 8 位为 1 组，用十进制表示，利用点分割各部分。【ABC 单播地址、DE 组播地址】

IP 保留地址：不分配给主机

127 的 A 类地址仅指本机

#### ICMP 控制报文协议（Internet Control Message Protocol）

由于 IP 协议是尽力而为的包传递服务，没有检测传递故障的机制。

ICMP：IP 协议的辅助协议，负责在包的投递过程中出现错误时向包源端报告错误信息。

帧头 + 帧有效载荷 （IP 头 + IP 有效载荷 （ICMP 头 + ICMP 有效载荷））

- 工作原理： ICMP 只能和源端通信（因为数据包头没有历史路径信息）

  - 1、包投递产生差错 -- ICMP 向包源端报告差错情况。
  - 2、源端必须把差错交给某个应用程序或采取其他措施来纠正。

- ICMP 协议基本功能：

  - 1、检测目标节点是否可达。ICMP ECHO（如：ping www.sina.com.cn）
  - 2、当路由器无法投递包时。向源端报告目标端不可达并丢弃。（报告 Code 代码，如下）
    - 0 网络不可达
    - 1 主机不可达
    - 2 协议不可达
    - 3 端口不可达
    - 4 需要分段但 DF 置位
    - 5 源路由失败
    - 6 目的网络未知
    - 7 目的主机未知
  - 3、拥塞控制通知。（当路由器因缓存溢出不得不丢包时，向源端发回一个拥塞报文，源端拥塞控制据此采取相应措施）
    - 拥塞原因 1：高速计算机产生的通信量比网络能传输的包多时
    - 拥塞原因 2：许多计算机发送的包同时需要通过某个路由器时
  - 4、重定向路由。（主机的路由学习能力）（主机没有按最后路由发送的情况下会触发 ICMP 重定向报文）
    - 一旦路由发生差错省却路由器通知主机重定向
    - 所有主机在启动时只需一个省却路由，通过发送 ICMP 重定向报文来学习。
  - 5、检测循环路由。（应付错误路由/丢包）
    - 由于路由表的错误，有可能导致路由环路循环下去，所以 IP 协议规定在每个 IP 包头设定一个生存期计时器 TTL，当路由器处理包的时候，要将该计时器减 1，并且在减到 0 的时候丢弃这个包。
    - 一旦路由器因包的 TTL 为 0 或主机等待包重组超时而丢弃该包时，向源端发回一个 ICMP 超时报文。
    - TTL（Time To Live）：IP 包被路由器丢弃之前允许通过的最大网段数量，即指 ICMP 包的转发次数（跳数）。
    - DNS TTL：域名解析信息在 DNS 中的存在时间
  - 6、传输时间估计值。（网络延迟的估算）
  - 7、请求子网地址掩码。（子网掩码判断是本地局域网通信还是）

- ICMP 协议其他应用示例：

  - 1、trace route 工具：跟踪路径
    - 利用 ICMP 超时报文发现到目的地一条路径上的路由器列表【原理就是动态控制 TTL 值（因为 TTL 为 0 时，会触发向源端返回 ICMP 超时报文），即测试主机分别发送 TTL 为 1、2、3、4...的生存期递增的包】
    - 发现当前路径路径 MTU（最大传输单元 Maximum Transmission Unit）。【利用包头中的“不能分 DF”标志位，通过探测的方式发现当前路径上的最小 MTU，进而提前分段，省去路由器去分段再重组】
      - 好处 1：途径的路由器无需对包进行分段
      - 好处 2：目的主机无需重组完整包

- 总结：
  - 针对数据报文的处理：是由 IP 协议和 ICMP 共同完成。
    - IP 负责：编码规则、包格式、包规则处理、报文格式制定、报文转发处理规则
    - ICMP 负责：协助 IP 协议完成包的传递、出现问题由 ICMP 向出错的源端报告差错情况
    - 路由器必须运行路由协议：OSPF 基于链路状态算法、BGP 距离矢量算法、即使没有报文需要传递的时候，路由器之前也要通过交换获得网络的当前的最新的状态信息或者路由信息，然后重新计算本地到达任何一个目的地的路径，当路径发生变化时要更新路由表，使得路由器上的路由表永远表示的是当前出发到任意一个目的地的最好的路径

#### ARP 协议（Address Resolution Protocol 地址解析协议）

- 动态消息交换法，获取最新的 IP 地址与 MAC 地址的映射关系。【需要解析地址时通过网络通信获得 IP 地址对应的物理地址】

- 地址解析：将 IP 地址解析成相应硬件地址的过程

- ARP 基于动态消息交换法，定义两类基本消息；请求和应答

- 其作用找出某个 IP 地址所对应的硬件地址

- ARP 协议规定：
  - 封装在硬件帧中的 ARP 报文被广播到 LAN 上。广播发送请求报文
  - 每台主机收到 ARP 请求后都检测其中的 IP 地址
  - 与 IP 地址匹配的主机单播一个应答报文作为相应。单播发送应答报文
  - 其他主机则丢弃收到的请求不做任何应答

ARP 缓存及优化（ARP 哈希表）：ARP 有一个高速缓存，用来存放最近获得的 IP 地址与硬件地址绑定信息。回答 ARP 请求后将请求消息中的发送方地址绑定信息加入自己的高速缓存。

IP 地址：类似邮政编码，特定于某个地理位置，不能携带着走
MAC 地址：类似身份证号码，不受限制，可携带着走
网卡把包封装成数据帧
主机调用 ARP 协议获取接收方的 MAC 地址用来完成数据帧的封装

#### DHCP（Dynamic Host Configuration Protocol 动态主机配置协议）

由服务器控制一段 IP 地址范围，客户机登录服务器时就可以自动获得服务器分配的 IP 地址和子网掩码。将客户主机 ip 地址设置为动态获取方式时，DHCP 服务器就会根据 DHCP 协议给客户端分配 IP，使得客户机能够利用这个 IP 上网。

- 客户机为了能接入因特网，必须首先获取一个 IP 地址作为自己在因特网中的 id，通过请求 DHCP 服务器。工作过程步骤如下：

  - 1、客户机：`广播`发送请求报文 dhcp discover，寻找本地网络可以为它提供地址服务的 DHCP 服务器
  - 2、DHCP 服务器：所有服务器从可用 IP 地址表中取出一个未分配的 IP 地址相应 dhcp offer 响应报文，以`广播`形式返回
  - 3、客户机：可能得到多个，它从所有返回 offer 的服务器中选择一个，`广播`发送 dhcp request 给选定的服务器来确认它所提供的地址信息，并告知所有其他 DHCP 服务器将使用的 IP 地址，以便其他 DHCP 服务器收回提供出去的 IP 地址将来提供新用户使用
  - 4、DHCP 服务器：被选的服务器就用 dhcp pack 响应报文`广播`ACK 确认，并同时提供其他上网参数。其余服务器将 offer 的 IP 地址放回可用 IP 地址列表中
  - 5、客户机：得到服服务器的确认后，还要用 ARP 测试获得的 ip 地址是否可用，若已有节点使用则向服务器`单播`返回 dhcp decline 报文，否则就用该 IP 地址配置本地网络。
  - 6、DHCP 服务器：收到 dhcp decline 报文后将该 ip 地址设为不可用

- 上网配置：

  - 1、网关地址
  - 2、域名服务器名字 DNS
  - 3、IP 地址
  - 4、本地网络划分的子网掩码

- 客户机续租 IP 地址。工作过程步骤如下：
  - 1、客户机：在使用了 IP 地址租赁时间 50%后，单播方式向服务器发送 dhcp request 请求继续使用 IP 地址报文
  - 2、DHCP 服务器：同意继续使用，用 dhcp pack 通知客户机更新租用期
  - 3、客户机：更新租期继续使用
  - 4、客户机：如果上面续租失败，可能丢包了，则 87.5%时又会再次发送请求...

#### NAT（Network Address Translation，网络地址转换）

- 内网如何编址？
- 私有地址不允许出现在因特网上
- 基于隧道技术的同一公司不同地区内网互联：每个内网必须至少拥有一个合法 ip 地址。
- 地址复用协议：在私有地址和全局可路由地址之间转换的协议。

- 实现其的路由器叫 NAT 路由器

- 引入目的：

  - 增加内网安全隐藏内网细节
  - 内联网用户需要访问因特网
  - DHCP 只能部分缓解 IP 地址不足（DHCP 按需为用户分配 IP 地址）
  - 小型企业和家庭需要全程在线连接因特网，其 IP 地址得不到释放，无法为其他用户共享

- 分为：
  - 静态 NAT
  - 动态 NAT
  - 网络端口地址转换 NAPT：仅限 TCP 或 UDP 高级协议。（使用端口+ip 共同），破坏端-端

#### IPV6

为上层用户提供不可靠的数据包传递服务，并具有一定服务质量保证

特点：足够、简化报头、灵活扩展、内置端-端安全认证和加密、本机地址自动配置、上网信息自动获取、提供不同服务质量的传输、解决漫游、去掉广播增加选播

IPV6 报文格式：基本头+扩展头+...+扩展头+有效载荷 payload

IPV6 数据包的分段重组：发送数据包的主机负责分段。`点分十进制`32 位
IPV4：路由器负责分段任务。`冒分十六进制`128 位

两个冒号代替连续的 0(只能用一次)，IPV4 到 IPV6 地址映射，96 个 0+ipv4（32 位）：

ipv4: '192.31.20.46'
ipv6: '::192.31.20.46'

IPV4 向 IPV6 过渡：双协议栈、6-in-4 隧道、NAT-PT

### 传输层

#### 需求与基本功能

#### 多路复用

#### 连接建立与终止

#### 通信的可靠

#### 拥塞控制

### TCP 和 UDP

#### UDP

#### TCP

### 流媒体

#### 应用层概述

#### 网络流媒体应用

#### 流式媒体

#### 直播与交互式流媒体

### 网络信息安全

#### 网络安全

#### 密码学

#### 信息安全

#### IPSec 和 SSL

### 结课
