<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react 学习 | easy bookmark</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/easy-bookmark/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?d517a1ee1e75b0fd216b5183a8f32ac0";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();      
      </script>
    <meta name="description" content="个人收藏">
    
    <link rel="preload" href="/easy-bookmark/assets/css/0.styles.9b6bb25f.css" as="style"><link rel="preload" href="/easy-bookmark/assets/js/app.98929521.js" as="script"><link rel="preload" href="/easy-bookmark/assets/js/2.6ed84ef8.js" as="script"><link rel="preload" href="/easy-bookmark/assets/js/19.cb360c51.js" as="script"><link rel="prefetch" href="/easy-bookmark/assets/js/10.59e2f598.js"><link rel="prefetch" href="/easy-bookmark/assets/js/11.9fc8a230.js"><link rel="prefetch" href="/easy-bookmark/assets/js/12.089b352b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/13.e2ac9449.js"><link rel="prefetch" href="/easy-bookmark/assets/js/14.a988d92c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/15.ae6ad2bb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/16.416459c2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/17.3aa5cbce.js"><link rel="prefetch" href="/easy-bookmark/assets/js/18.b724b90f.js"><link rel="prefetch" href="/easy-bookmark/assets/js/20.469dd230.js"><link rel="prefetch" href="/easy-bookmark/assets/js/21.62b9147c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/22.dabef7dd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/23.ffa9fcfd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/24.a4781c35.js"><link rel="prefetch" href="/easy-bookmark/assets/js/25.79ef71a6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/26.331c4dc5.js"><link rel="prefetch" href="/easy-bookmark/assets/js/27.5b1f1b94.js"><link rel="prefetch" href="/easy-bookmark/assets/js/28.37dd571e.js"><link rel="prefetch" href="/easy-bookmark/assets/js/29.580f58e7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/3.24a9cbfa.js"><link rel="prefetch" href="/easy-bookmark/assets/js/30.0630daa0.js"><link rel="prefetch" href="/easy-bookmark/assets/js/31.172b9e48.js"><link rel="prefetch" href="/easy-bookmark/assets/js/32.3c9adea6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/33.5595eb88.js"><link rel="prefetch" href="/easy-bookmark/assets/js/34.931e4ffe.js"><link rel="prefetch" href="/easy-bookmark/assets/js/35.c06f071e.js"><link rel="prefetch" href="/easy-bookmark/assets/js/36.bc28c146.js"><link rel="prefetch" href="/easy-bookmark/assets/js/37.50b96313.js"><link rel="prefetch" href="/easy-bookmark/assets/js/38.61fdc3da.js"><link rel="prefetch" href="/easy-bookmark/assets/js/39.8e94008c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/4.5591ca6b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/40.b9dd3fe7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/41.44f4e080.js"><link rel="prefetch" href="/easy-bookmark/assets/js/42.cf495ac2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/43.96432862.js"><link rel="prefetch" href="/easy-bookmark/assets/js/44.28acc21b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/45.10534c91.js"><link rel="prefetch" href="/easy-bookmark/assets/js/46.6d79e8a6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/47.a7759570.js"><link rel="prefetch" href="/easy-bookmark/assets/js/48.bc0667ab.js"><link rel="prefetch" href="/easy-bookmark/assets/js/49.c1ebffce.js"><link rel="prefetch" href="/easy-bookmark/assets/js/5.3de96ffc.js"><link rel="prefetch" href="/easy-bookmark/assets/js/50.a0f50760.js"><link rel="prefetch" href="/easy-bookmark/assets/js/51.52913321.js"><link rel="prefetch" href="/easy-bookmark/assets/js/52.b2c32e3a.js"><link rel="prefetch" href="/easy-bookmark/assets/js/53.cd133ce2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/54.5becf481.js"><link rel="prefetch" href="/easy-bookmark/assets/js/55.3ec180c8.js"><link rel="prefetch" href="/easy-bookmark/assets/js/56.24bf3181.js"><link rel="prefetch" href="/easy-bookmark/assets/js/57.5edd1dc7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/58.697b6057.js"><link rel="prefetch" href="/easy-bookmark/assets/js/59.c422bbd3.js"><link rel="prefetch" href="/easy-bookmark/assets/js/6.010a5dd5.js"><link rel="prefetch" href="/easy-bookmark/assets/js/60.b44a3b13.js"><link rel="prefetch" href="/easy-bookmark/assets/js/61.36d0c1bd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/62.e4917905.js"><link rel="prefetch" href="/easy-bookmark/assets/js/63.690191bf.js"><link rel="prefetch" href="/easy-bookmark/assets/js/64.e6e01d48.js"><link rel="prefetch" href="/easy-bookmark/assets/js/65.13387ea7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/66.37c48ee9.js"><link rel="prefetch" href="/easy-bookmark/assets/js/67.fa7e4f5a.js"><link rel="prefetch" href="/easy-bookmark/assets/js/68.eb40d0ee.js"><link rel="prefetch" href="/easy-bookmark/assets/js/69.584d43ea.js"><link rel="prefetch" href="/easy-bookmark/assets/js/7.48552666.js"><link rel="prefetch" href="/easy-bookmark/assets/js/70.3abc29fb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/71.e149adad.js"><link rel="prefetch" href="/easy-bookmark/assets/js/72.b73ecb17.js"><link rel="prefetch" href="/easy-bookmark/assets/js/73.9307c017.js"><link rel="prefetch" href="/easy-bookmark/assets/js/74.c1502fb4.js"><link rel="prefetch" href="/easy-bookmark/assets/js/75.69f4626b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/76.c25802cb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/77.a37efc00.js"><link rel="prefetch" href="/easy-bookmark/assets/js/8.a079a873.js"><link rel="prefetch" href="/easy-bookmark/assets/js/9.e1d2376d.js">
    <link rel="stylesheet" href="/easy-bookmark/assets/css/0.styles.9b6bb25f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/easy-bookmark/" class="home-link router-link-active"><img src="/easy-bookmark/logo.jpg" alt="easy bookmark" class="logo"> <span class="site-name can-hide">easy bookmark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/easy-bookmark/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/easy-bookmark/blogs/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/easy-bookmark/website/" class="nav-link">
  网站
</a></div><div class="nav-item"><a href="/easy-bookmark/daily/" class="nav-link">
  日常
</a></div><div class="nav-item"><a href="/easy-bookmark/front/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/easy-bookmark/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://foreverwaiting.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/foreverwaiting/easy-bookmark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/easy-bookmark/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/easy-bookmark/blogs/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/easy-bookmark/website/" class="nav-link">
  网站
</a></div><div class="nav-item"><a href="/easy-bookmark/daily/" class="nav-link">
  日常
</a></div><div class="nav-item"><a href="/easy-bookmark/front/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/easy-bookmark/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://foreverwaiting.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/foreverwaiting/easy-bookmark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/easy-bookmark/blogs/Article.html" class="sidebar-link">好的文章</a></li><li><a href="/easy-bookmark/blogs/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/easy-bookmark/blogs/ES6.html" class="sidebar-link">ES6</a></li><li><a href="/easy-bookmark/blogs/Javascript.html" class="sidebar-link">Javascript</a></li><li><a href="/easy-bookmark/blogs/MicroService.html" class="sidebar-link">微服务</a></li><li><a href="/easy-bookmark/blogs/" aria-current="page" class="sidebar-link">态度</a></li><li><a href="/easy-bookmark/blogs/TS.html" class="sidebar-link">typescript</a></li><li><a href="/easy-bookmark/blogs/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/easy-bookmark/blogs/mdn.html" class="sidebar-link">MDN JavaScript</a></li><li><a href="/easy-bookmark/blogs/node.html" class="sidebar-link">node</a></li><li><a href="/easy-bookmark/blogs/others.html" class="sidebar-link">其他</a></li><li><a href="/easy-bookmark/blogs/react.html" aria-current="page" class="active sidebar-link">react 学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-基础入门" class="sidebar-link">react 基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#html-模板" class="sidebar-link">HTML 模板</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#reactdom-render" class="sidebar-link">ReactDOM.render()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#jsx-语法" class="sidebar-link">JSX 语法</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#组件" class="sidebar-link">组件</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#this-props-children" class="sidebar-link">this.props.children</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#proptypes" class="sidebar-link">PropTypes</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#获取真实的dom节点" class="sidebar-link">获取真实的DOM节点</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#this-state" class="sidebar-link">this.state</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#表单" class="sidebar-link">表单</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#组件的生命周期" class="sidebar-link">组件的生命周期</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#ajax" class="sidebar-link">Ajax</a></li></ul></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#redux" class="sidebar-link">Redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#设计思想" class="sidebar-link">设计思想</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-store" class="sidebar-link">基本概念-Store</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-state" class="sidebar-link">基本概念-State</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-action" class="sidebar-link">基本概念-Action</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-action-creator" class="sidebar-link">基本概念-Action Creator</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-store-dispatch" class="sidebar-link">基本概念-store.dispatch()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-reducer" class="sidebar-link">基本概念-Reducer</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-纯函数" class="sidebar-link">基本概念-纯函数</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-store-subscribe" class="sidebar-link">基本概念-store.subscribe()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-store-的实现" class="sidebar-link">基本概念-Store 的实现</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-reducer-的拆分" class="sidebar-link">基本概念-Reducer 的拆分</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#基本概念-redux-的工作流程总结" class="sidebar-link">基本概念-Redux 的工作流程总结</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#redux-的基本做法" class="sidebar-link">Redux 的基本做法：</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#中间件-中间件的概念" class="sidebar-link">中间件-中间件的概念</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#中间件-中间件的用法" class="sidebar-link">中间件-中间件的用法</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#中间件-applymiddlewares" class="sidebar-link">中间件-applyMiddlewares()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#中间件-异步操作的基本思路" class="sidebar-link">中间件-异步操作的基本思路</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#中间件-redux-thunk-中间件" class="sidebar-link">中间件-redux-thunk 中间件</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#异步操作-redux-promise-中间件" class="sidebar-link">异步操作-redux-promise 中间件</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-组件分类" class="sidebar-link">React-Redux用法-组件分类</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-connect" class="sidebar-link">React-Redux用法-connect()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-mapstatetoprops" class="sidebar-link">React-Redux用法-mapStateToProps()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-mapdispatchtoprops" class="sidebar-link">React-Redux用法-mapDispatchToProps()</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-provider-组件" class="sidebar-link">React-Redux用法-Provider 组件</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-redux用法-实例-计数器" class="sidebar-link">React-Redux用法-实例：计数器</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#redux完整示例" class="sidebar-link">redux完整示例</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-react-的两套-api" class="sidebar-link">React 钩子-React 的两套 API</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-类和函数的差异" class="sidebar-link">React 钩子-类和函数的差异</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-副效应是什么" class="sidebar-link">React 钩子-副效应是什么？</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-钩子-hook-的作用" class="sidebar-link">React 钩子-钩子（hook）的作用</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-useeffect-的用法" class="sidebar-link">React 钩子-useEffect() 的用法</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-useeffect-的第二个参数" class="sidebar-link">React 钩子-useEffect() 的第二个参数</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-useeffect-的用途" class="sidebar-link">React 钩子-useEffect() 的用途</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-useeffect-的返回值" class="sidebar-link">React 钩子-useEffect() 的返回值</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-钩子-useeffect-的注意点" class="sidebar-link">React 钩子-useEffect() 的注意点</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-组件类的缺点" class="sidebar-link">React Hooks-组件类的缺点</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-函数组件" class="sidebar-link">React Hooks-函数组件</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-hook-的含义" class="sidebar-link">React Hooks-Hook 的含义</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-usestate-状态钩子" class="sidebar-link">React Hooks-useState()：状态钩子</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-usecontext-共享状态钩子" class="sidebar-link">React Hooks-useContext()：共享状态钩子</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-usereducer-action-钩子" class="sidebar-link">React Hooks-useReducer()：action 钩子</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-useeffect-副作用钩子" class="sidebar-link">React Hooks-useEffect()：副作用钩子</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-hooks-创建自己的-hooks" class="sidebar-link">React Hooks-创建自己的 Hooks</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#umi3-使用-dva" class="sidebar-link">umi3 使用 dva</a></li></ul></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#react-native" class="sidebar-link">react native</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/react.html#next-ssr" class="sidebar-link">Next ssr</a></li></ul></li><li><a href="/easy-bookmark/blogs/safe.html" class="sidebar-link">前端安全</a></li><li><a href="/easy-bookmark/blogs/vue.html" class="sidebar-link">vue</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-学习"><a href="#react-学习" class="header-anchor">#</a> react 学习</h1> <h2 id="react-基础入门"><a href="#react-基础入门" class="header-anchor">#</a> react 基础入门</h2> <h3 id="html-模板"><a href="#html-模板" class="header-anchor">#</a> HTML 模板</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../build/react.development.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> React核心库
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../build/react-dom.development.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 提供DOM相关功能
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../build/babel.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 将JSX语法转化为JavaScript语法
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 将一个 h1 标题，插入 example 节点 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>example<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/babel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>type=&quot;text/babel&quot;： script 标签的 type 属性为 text/babel 。这是因为 React 独有的 JSX 语法，跟 JavaScript 不兼容。凡是使用 JSX 的地方，都要加上 type=&quot;text/babel&quot; 。</li></ul> <h3 id="reactdom-render"><a href="#reactdom-render" class="header-anchor">#</a> ReactDOM.render()</h3> <ul><li>ReactDOM.render： 是 React 的最基本方法，用于将模板转为 HTML 语言，并插入指定的 DOM 节点。</li></ul> <h3 id="jsx-语法"><a href="#jsx-语法" class="header-anchor">#</a> JSX 语法</h3> <ul><li><p>JSX 的语法： HTML 语言直接写在 JavaScript 语言之中，不加任何引号，这就是 JSX 的语法。</p></li> <li><p>JSX 的基本语法规则： 遇到 HTML 标签（以 &lt; 开头），就用 HTML 规则解析；遇到代码块（以 { 开头），就用 JavaScript 规则解析。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'Emily'</span><span class="token punctuation">,</span> <span class="token string">'Kate'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span>
    names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>JSX 允许直接在模板插入 JavaScript 变量。如果这个变量是一个数组，则会展开这个数组的所有成员</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>React is awesome<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>arr<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h3> <ul><li>组件React.createClass： 组件类的第一个字母必须大写，否则会报错。组件类只能包含一个顶层标签，否则也会报错。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 变量 HelloMessage 就是一个组件类</span>
<span class="token comment">// 所有组件类都必须有自己的 render 方法，用于输出组件。</span>
<span class="token keyword">var</span> HelloMessage <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 模板插入 &lt;HelloMessage /&gt; 时，会自动生成 HelloMessage 的一个实例</span>

<span class="token comment">// 组件的用法与原生的 HTML 标签完全一致，可以任意加入属性。如下的name，添加组件属性，有一个地方需要注意，就是 class 属性需要写成 className ，for 属性需要写成 htmlFor ，这是因为 class 和 for 是 JavaScript 的保留字。</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>HelloMessage name<span class="token operator">=</span><span class="token string">&quot;John&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>组件的属性可以在组件类的 this.props 对象上获取。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 如上组件&lt;HelloMessage name=&quot;John&quot; /&gt;的属性可在组件类通过this.props对象上获取</span>
<span class="token keyword">var</span> HelloMessage <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>
      Hello <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
      some text
    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="this-props-children"><a href="#this-props-children" class="header-anchor">#</a> this.props.children</h3> <ul><li>this.props 对象的属性与组件的属性一一对应，但是有一个例外，就是 this.props.children 属性。它表示组件的所有子节点。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// this.props.children 的值有三种可能:处理 this.props.children 的时候要小心。</span>
    <span class="token comment">// 当前组件没有子节点，它就是 undefined</span>
    <span class="token comment">// 有一个子节点，数据类型是 object</span>
    <span class="token comment">// 有多个子节点，数据类型就是 array</span>
<span class="token keyword">var</span> NotesList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ol<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>
        React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span>child<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ol<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// React 提供一个工具方法 React.Children 来处理 this.props.children</span>
    <span class="token comment">// 可以用 React.Children.map 来遍历子节点，而不用担心 this.props.children 的数据类型是 undefined 还是 object。</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>NotesList<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>NotesList<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>body
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="proptypes"><a href="#proptypes" class="header-anchor">#</a> PropTypes</h3> <ul><li>PropTypes：组件类的PropTypes属性，就是用来验证组件实例的属性是否符合要求，组件的属性可以接受任意值，字符串、对象、函数等等都可以。有时，我们需要一种机制，验证别人使用组件时，提供的参数是否符合要求。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// PropTypes 告诉 React，这个 title 属性是必须的，而且它的值必须是字符串。通不过验证时。控制台会显示一行错误信息</span>
<span class="token keyword">var</span> MyTitle <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">propTypes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// getDefaultProps 方法可以用来设置组件属性的默认值。设置title默认值。</span>
<span class="token keyword">var</span> MyTitle <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getDefaultProps</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span> <span class="token operator">:</span> <span class="token string">'Hello World'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>MyTitle <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>body
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="获取真实的dom节点"><a href="#获取真实的dom节点" class="header-anchor">#</a> 获取真实的DOM节点</h3> <ul><li>获取真实的DOM节点：有时需要从组件获取真实 DOM 的节点，这时就要用到 ref 属性。</li></ul> <div class="custom-block tip"><p class="custom-block-title">DOM diff</p> <p>组件并不是真实的 DOM 节点，而是存在于内存之中的一种数据结构，叫做虚拟 DOM （virtual DOM）。只有当它插入文档以后，才会变成真实的 DOM 。根据 React 的设计，所有的 DOM 变动，都先在虚拟 DOM 上发生，然后再将实际发生变动的部分，反映在真实 DOM上，这种算法叫做 DOM diff ，它可以极大提高网页的性能表现。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 由于 this.refs.[refName] 属性获取的是真实 DOM ，所以必须等到虚拟 DOM 插入文档以后，才能使用这个属性，否则会报错。</span>
<span class="token keyword">var</span> MyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">handleClick</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>myTextInput<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;myTextInput&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Focus the text input&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="this-state"><a href="#this-state" class="header-anchor">#</a> this.state</h3> <ul><li>组件免不了要与用户互动，React 的一大创新，就是将组件看成是一个状态机，一开始有一个初始状态，然后用户互动，导致状态变化，从而触发重新渲染 UI</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// LikeButton 组件</span>
<span class="token comment">// getInitialState 方法用于定义初始状态，也就是一个对象，这个对象可以通过 this.state 属性读取。</span>
<span class="token comment">// 用户点击组件，导致状态变化，this.setState 方法就修改状态值，每次修改以后，自动调用 this.render 方法，再次渲染组件。</span>
<span class="token keyword">var</span> LikeButton <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">liked</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleClick</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">liked</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>liked<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>liked <span class="token operator">?</span> <span class="token string">'like'</span> <span class="token operator">:</span> <span class="token string">'haven\'t liked'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        You <span class="token punctuation">{</span>text<span class="token punctuation">}</span> <span class="token keyword">this</span><span class="token punctuation">.</span> Click to toggle<span class="token punctuation">.</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>LikeButton <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>this.props 和 this.state: this.props 表示那些一旦定义，就不再改变的特性，，this.state 是会随着用户互动而产生变化的特性</li></ul> <h3 id="表单"><a href="#表单" class="header-anchor">#</a> 表单</h3> <ul><li>用户在表单填入的内容，属于用户跟组件的互动，所以不能用 this.props 读取</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 文本输入框的值，不能用 this.props.value 读取</span>
<span class="token comment">// 定义一个 onChange 事件的回调函数，通过 event.target.value 读取用户输入的值。textarea 元素、select元素、radio元素都属于这种情况</span>
<span class="token keyword">var</span> Input <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'Hello!'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleChange</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="组件的生命周期"><a href="#组件的生命周期" class="header-anchor">#</a> 组件的生命周期</h3> <p>基础状态：will 函数在进入状态之前调用，did 函数在进入状态之后调用</p> <ul><li>Mounting：已插入真实 DOM
<ul><li>componentWillMount()</li> <li>componentDidMount()</li></ul></li> <li>Updating：正在被重新渲染
<ul><li>componentWillUpdate(object nextProps, object nextState)</li> <li>componentDidUpdate(object prevProps, object prevState)</li></ul></li> <li>Unmounting：已移出真实 DOM
<ul><li>componentWillUnmount()
两种特殊状态的处理函数：</li></ul></li> <li>componentWillReceiveProps(object nextProps)：已加载组件收到新的参数时调用</li> <li>shouldComponentUpdate(object nextProps, object nextState)：组件判断是否重新渲染时调用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在hello组件加载以后，通过 componentDidMount 方法设置一个定时器，每隔100毫秒，就重新设置组件的透明度，从而引发重新渲染。</span>
<span class="token keyword">var</span> Hello <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1.0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">componentDidMount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> opacity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>opacity<span class="token punctuation">;</span>
      opacity <span class="token operator">-=</span> <span class="token number">.05</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>opacity <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        opacity <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> opacity
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>opacity<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        Hello <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Hello name<span class="token operator">=</span><span class="token string">&quot;world&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>body
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ajax"><a href="#ajax" class="header-anchor">#</a> Ajax</h3> <ul><li>使用 componentDidMount 方法设置 Ajax 请求</li> <li>请求成功，再用 this.setState 方法重新渲染 UI</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> UserGist <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastGistUrl</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">componentDidMount</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>source<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> lastGist <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isMounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">username</span><span class="token operator">:</span> lastGist<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>login<span class="token punctuation">,</span>
          <span class="token literal-property property">lastGistUrl</span><span class="token operator">:</span> lastGist<span class="token punctuation">.</span>html_url
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>username<span class="token punctuation">}</span>'s last gist is
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lastGistUrl<span class="token punctuation">}</span><span class="token operator">&gt;</span>here<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">.</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>UserGist source<span class="token operator">=</span><span class="token string">&quot;https://api.github.com/users/octocat/gists&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>body
<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">// </span>
<span class="token comment">// 从Github的API抓取数据，然后将Promise对象作为属性，传给RepoList组件</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>RepoList
    promise<span class="token operator">=</span><span class="token punctuation">{</span>$<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'https://api.github.com/search/repositories?q=javascript&amp;sort=stars'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span>body
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果Promise对象正在抓取数据（pending状态），组件显示&quot;正在加载&quot;；如果Promise对象报错（rejected状态），组件显示报错信息；如果Promise对象抓取数据成功（fulfilled状态），组件显示获取的数据。</span>
<span class="token keyword">var</span> RepoList <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
      <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> error<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>Error<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> repos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">;</span>
      <span class="token keyword">var</span> repoList <span class="token operator">=</span> repos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">repo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>repo<span class="token punctuation">.</span>html_url<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>repo<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>repo<span class="token punctuation">.</span>stargazers_count<span class="token punctuation">}</span> stars<span class="token punctuation">)</span> <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>repo<span class="token punctuation">.</span>description<span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Most Popular JavaScript Projects <span class="token keyword">in</span> Github<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>ol<span class="token operator">&gt;</span><span class="token punctuation">{</span>repoList<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ol<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="redux"><a href="#redux" class="header-anchor">#</a> Redux</h2> <h3 id="设计思想"><a href="#设计思想" class="header-anchor">#</a> 设计思想</h3> <p>（1）Web 应用是一个状态机，视图与状态是一一对应的。</p> <p>（2）所有的状态，保存在一个对象里面。</p> <h3 id="基本概念-store"><a href="#基本概念-store" class="header-anchor">#</a> 基本概念-Store</h3> <ul><li>保存数据的地方，可以把它看成一个容器。整个应用只能有一个 Store</li> <li>提供createStore函数，用来生成 Store</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// createStore函数接受另一个函数作为参数，返回新生成的 Store 对象</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-state"><a href="#基本概念-state" class="header-anchor">#</a> 基本概念-State</h3> <ul><li>Store对象包含所有数据：如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。</li> <li>当前时刻的 State，可以通过store.getState()拿到</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个 State 对应一个 View。只要 State 相同，View 就相同</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-action"><a href="#基本概念-action" class="header-anchor">#</a> 基本概念-Action</h3> <ul><li>Action 就是 View 发出的通知，表示 State 应该要发生变化了。State 的变化，会导致 View 的变化。但是，用户接触不到 State，只能接触到 View。所以，State 的变化必须是 View 导致的。</li> <li>Action 是一个对象。其中的type属性是必须的，表示 Action 的名称。其他属性可以自由设置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Action 的名称是ADD_TODO，它携带的信息是字符串Learn Redux。</span>
<span class="token comment">// Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。</span>
<span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Learn Redux'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-action-creator"><a href="#基本概念-action-creator" class="header-anchor">#</a> 基本概念-Action Creator</h3> <ul><li>View 要发送多少种消息，就会有多少种 Action。如果都手写，会很麻烦。可以定义一个函数来生成 Action，这个函数就叫 Action Creator。、</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// addTodo函数就是一个 Action Creator。</span>
<span class="token keyword">const</span> <span class="token constant">ADD_TODO</span> <span class="token operator">=</span> <span class="token string">'添加 TODO'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD_TODO</span><span class="token punctuation">,</span>
    text
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'Learn Redux'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-store-dispatch"><a href="#基本概念-store-dispatch" class="header-anchor">#</a> 基本概念-store.dispatch()</h3> <ul><li>store.dispatch()是 View 发出 Action 的唯一方法。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// store.dispatch接受一个 Action 对象作为参数，将它发送出去。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Learn Redux'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结合 Action Creator，这段代码可以改写如下。</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'Learn Redux'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-reducer"><a href="#基本概念-reducer" class="header-anchor">#</a> 基本概念-Reducer</h3> <ul><li>Store 收到 Action 以后，必须给出一个新的 State，这样 View 才会发生变化。这种 State 的计算过程就叫做 Reducer。Reducer 是一个函数，它接受 Action 和当前 State 作为参数，返回一个新的 State。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> new_state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>整个应用的初始状态，可以作为 State 的默认值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// reducer函数收到名为ADD的 Action 以后，就返回一个新的 State，作为加法的计算结果。其他运算的逻辑（比如减法），也可以根据 Action 的不同来实现。</span>
<span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> 
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实际应用中，Reducer 函数不用像上面这样手动调用，store.dispatch方法会触发 Reducer 的自动执行。为此，Store 需要知道 Reducer 函数，做法就是在生成 Store 的时候，将 Reducer 传入createStore方法。</span>
<span class="token comment">// createStore接受 Reducer 作为参数，生成一个新的 Store。以后每当store.dispatch发送过来一个新的 Action，就会自动调用 Reducer，得到新的 State。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>为什么这个函数叫做 Reducer 呢?因为它可以作为数组的reduce方法的参数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一系列 Action 对象按照顺序作为一个数组</span>
<span class="token comment">// 数组actions表示依次有三个 Action，分别是加0、加1和加2。数组的reduce方法接受 Reducer 函数作为参数，就可以直接得到最终的状态3</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> total <span class="token operator">=</span> actions<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="基本概念-纯函数"><a href="#基本概念-纯函数" class="header-anchor">#</a> 基本概念-纯函数</h3> <ul><li>Reducer 函数最重要的特征是，它是一个纯函数。也就是说，只要是同样的输入，必定得到同样的输出。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>纯函数是函数式编程的概念，必须遵守以下一些约束:
不得改写参数
不能调用系统 I/O 的API
不能调用Date.now()或者Math.random()等不纯的方法，因为每次会得到不一样的结果</p></div> <ul><li>由于 Reducer 是纯函数，就可以保证同样的State，必定得到同样的 View。但也正因为这一点，Reducer 函数里面不能改变 State，必须返回一个全新的对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// State 是一个对象</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span> thingToChange <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 或者</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>newState <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// State 是一个数组</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> newItem<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 最好把 State 对象设成只读。你没法改变它，要得到新的 State，唯一办法就是生成一个新对象。这样的好处是，任何时候，与某个 View 对应的 State 总是一个不变的对象。</span>
</code></pre></div><h3 id="基本概念-store-subscribe"><a href="#基本概念-store-subscribe" class="header-anchor">#</a> 基本概念-store.subscribe()</h3> <ul><li>Store 允许使用store.subscribe方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 显然，只要把 View 的更新函数（对于 React 项目，就是组件的render方法或setState方法）放入listen，就会实现 View 的自动渲染。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>store.subscribe方法返回一个函数，调用这个函数就可以解除监听。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="基本概念-store-的实现"><a href="#基本概念-store-的实现" class="header-anchor">#</a> 基本概念-Store 的实现</h3> <ul><li>Redux 涉及的基本概念，可以发现 Store 提供了三个方法。
store.getState()
store.dispatch()
store.subscribe()</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> subscribe<span class="token punctuation">,</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>createStore方法还可以接受第二个参数，表示 State 的最初状态。这通常是服务器给出的。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todoApp<span class="token punctuation">,</span> window<span class="token punctuation">.</span><span class="token constant">STATE_FROM_SERVER</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="基本概念-reducer-的拆分"><a href="#基本概念-reducer-的拆分" class="header-anchor">#</a> 基本概念-Reducer 的拆分</h3> <ul><li><p>Reducer 函数负责生成 State。由于整个应用只有一个 State 对象，包含所有数据，对于大型应用来说，这个 State 必然十分庞大，导致 Reducer 函数也十分庞大。</p></li> <li><p>Redux 提供了一个combineReducers方法，用于 Reducer 的拆分。你只要定义各个子 Reducer 函数，然后用这个方法，将它们合成一个大的 Reducer。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过combineReducers方法将三个子 Reducer 合并成一个大的函数。</span>
<span class="token comment">// 这种写法有一个前提，就是 State 的属性名必须与子 Reducer 同名</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> chatReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  chatLog<span class="token punctuation">,</span>
  statusMessage<span class="token punctuation">,</span>
  userName
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> todoApp<span class="token punctuation">;</span>
<span class="token comment">// 总之，combineReducers()做的就是产生一个整体的 Reducer 函数。该函数根据 State 的 key 去执行相应的子 Reducer，并将返回结果合并成一个大的 State 对象。</span>
</code></pre></div><h3 id="基本概念-redux-的工作流程总结"><a href="#基本概念-redux-的工作流程总结" class="header-anchor">#</a> 基本概念-Redux 的工作流程总结</h3> <img src="/easy-bookmark/react.jpg" alt="react"> <ul><li><p>首先，用户发出 Action：store.dispatch(action);</p></li> <li><p>然后，Store 自动调用 Reducer，并且传入两个参数：当前 State 和收到的 Action。 Reducer 会返回新的 State ：let nextState = todoApp(previousState, action);</p></li> <li><p>State 一旦有变化，Store 就会调用监听函数：store.subscribe(listener);</p></li> <li><p>listener可以通过store.getState()得到当前状态。如果使用的是 React，这时可以触发重新渲染 View。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">listerner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newState <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  component<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实例：计数器</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 作用就是把参数value的值，显示在网页上</span>
<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value<span class="token punctuation">,</span> onIncrement<span class="token punctuation">,</span> onDecrement <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncrement<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onDecrement<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 为Counter添加递增和递减的 Action。</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Counter
      value<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      onIncrement<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      onDecrement<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'DECREMENT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Store 的监听函数设置为render，每次 State 的变化都会导致网页重新渲染。</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="redux-的基本做法"><a href="#redux-的基本做法" class="header-anchor">#</a> Redux 的基本做法：</h3> <ul><li>用户发出 Action，Reducer 函数算出新的 State，View 重新渲染。</li> <li>但一个关键问题没有解决：异步操作怎么办？Action 发出以后，Reducer 立即算出 State，这叫做同步；Action 发出以后，过一段时间再执行 Reducer，这就是异步。</li> <li>怎么才能 Reducer 在异步操作结束后自动执行呢？这就要用到新的工具：中间件（middleware）。</li></ul> <h3 id="中间件-中间件的概念"><a href="#中间件-中间件的概念" class="header-anchor">#</a> 中间件-中间件的概念</h3> <ul><li>中间件就是一个函数，对store.dispatch方法进行了改造，在发出 Action 和执行 Reducer 这两步之间，添加了其他功能。</li></ul> <h3 id="中间件-中间件的用法"><a href="#中间件-中间件的用法" class="header-anchor">#</a> 中间件-中间件的用法</h3> <ul><li>常用的中间件都有现成的，只要引用别人写好的模块即可</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 怎么使用中间件</span>
<span class="token comment">// redux-logger提供一个生成器createLogger，可以生成日志中间件logger</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createLogger <span class="token keyword">from</span> <span class="token string">'redux-logger'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将它放在applyMiddleware方法之中，传入createStore方法，就完成了store.dispatch()的功能增强。 </span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// （1）createStore方法可以接受整个应用的初始状态作为参数，那样的话，applyMiddleware就是第三个参数了。</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  initial_state<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// （2）中间件的次序有讲究。</span>
<span class="token comment">// applyMiddleware方法的三个参数，就是三个中间件。有的中间件有次序要求，使用前要查一下文档。</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span> promise<span class="token punctuation">,</span> logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="中间件-applymiddlewares"><a href="#中间件-applymiddlewares" class="header-anchor">#</a> 中间件-applyMiddlewares()</h3> <ul><li><p>applyMiddlewares:  Redux 的原生方法，作用是将所有中间件组成一个数组，依次执行。</p></li> <li><p>所有中间件被放进了一个数组chain，然后嵌套执行，最后执行store.dispatch。可以看到，中间件内部（middlewareAPI）可以拿到getState和dispatch这两个方法。</p></li></ul> <h3 id="中间件-异步操作的基本思路"><a href="#中间件-异步操作的基本思路" class="header-anchor">#</a> 中间件-异步操作的基本思路</h3> <ul><li>同步操作只要发出一种 Action 即可，异步操作的差别是它要发出三种 Action。操作发起时的 Action操作成功时的 Action操作失败时的 Action</li></ul> <h3 id="中间件-redux-thunk-中间件"><a href="#中间件-redux-thunk-中间件" class="header-anchor">#</a> 中间件-redux-thunk 中间件</h3> <ul><li><p>异步操作至少要送出两个 Action：用户触发第一个 Action，这个跟同步操作一样，没有问题；如何才能在操作结束时，系统自动送出第二个 Action 呢？</p></li> <li><p>使用redux-thunk中间件，改造store.dispatch，使得后者可以接受函数作为参数。因此，异步操作的第一种解决方案就是，写出一个返回函数的 Action Creator，然后使用redux-thunk中间件改造store.dispatch</p></li></ul> <h3 id="异步操作-redux-promise-中间件"><a href="#异步操作-redux-promise-中间件" class="header-anchor">#</a> 异步操作-redux-promise 中间件</h3> <ul><li><p>异步操作的解决方案，就是让 Action Creator 返回一个 Promise 对象。</p></li> <li><p>如果 Action 本身是一个 Promise，它 resolve 以后的值应该是一个 Action 对象，会被dispatch方法送出（action.then(dispatch)），但reject 以后不会有任何动作；如果 Action 对象的payload属性是一个 Promise 对象，那么无论 resolve 和 reject，dispatch方法都会发出 Action。</p></li></ul> <h3 id="react-redux用法-组件分类"><a href="#react-redux用法-组件分类" class="header-anchor">#</a> React-Redux用法-组件分类</h3> <ul><li><p>组件分成两大类：UI 组件（presentational component）和容器组件（container component）。UI 组件负责 UI 的呈现，容器组件负责管理数据和逻辑。</p></li> <li><p>如果一个组件既有 UI 又有业务逻辑，那怎么办？回答是，将它拆分成下面的结构：外面是一个容器组件，里面包了一个UI 组件。前者负责与外部的通信，将数据传给后者，由后者渲染出视图。</p></li></ul> <p>1、UI 组件：
只负责 UI 的呈现，不带有任何业务逻辑
没有状态（即不使用this.state这个变量）
所有数据都由参数（this.props）提供
不使用任何 Redux 的 API</p> <p>2、容器组件
负责管理数据和业务逻辑，不负责 UI 的呈现
带有内部状态
使用 Redux 的 API</p> <p>你可能会问，如果一个组件既有 UI 又有业务逻辑，那怎么办？回答是，将它拆分成下面的结构：外面是一个容器组件，里面包了一个UI 组件。前者负责与外部的通信，将数据传给后者，由后者渲染出视图。</p> <p>React-Redux 规定，所有的 UI 组件都由用户提供，容器组件则是由 React-Redux 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</p> <h3 id="react-redux用法-connect"><a href="#react-redux用法-connect" class="header-anchor">#</a> React-Redux用法-connect()</h3> <ul><li>React-Redux 提供connect方法，用于从 UI 组件生成容器组件。connect的意思，就是将这两种组件连起来。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TodoList是 UI 组件，VisibleTodoList就是由 React-Redux 通过connect方法自动生成的容器组件。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">const</span> VisibleTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// connect方法的完整 API </span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">const</span> VisibleTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>
<span class="token comment">// connect方法接受两个参数：mapStateToProps和mapDispatchToProps。</span>

<span class="token comment">// 定义了 UI 组件的业务逻辑。前者负责输入逻辑，即将state映射到 UI 组件的参数（props），后者负责输出逻辑，即将用户对 UI 组件的操作映射成 Action。</span>
</code></pre></div><h3 id="react-redux用法-mapstatetoprops"><a href="#react-redux用法-mapstatetoprops" class="header-anchor">#</a> React-Redux用法-mapStateToProps()</h3> <ul><li>mapStateToProps是一个函数。它的作用就是像它的名字那样，建立一个从（外部的）state对象到（UI 组件的）props对象的映射关系。作为函数，mapStateToProps执行后应该返回一个对象，里面的每一个键值对就是一个映射。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mapStateToProps是一个函数，它接受state作为参数，返回一个对象。</span>
<span class="token comment">// 对象有一个todos属性，代表 UI 组件的同名参数，后面的getVisibleTodos也是一个函数，可以从state算出 todos 的值。</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> state<span class="token punctuation">.</span>visibilityFilter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// getVisibleTodos</span>
<span class="token keyword">const</span> <span class="token function-variable function">getVisibleTodos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">todos<span class="token punctuation">,</span> filter</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SHOW_ALL'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos
    <span class="token keyword">case</span> <span class="token string">'SHOW_COMPLETED'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token string">'SHOW_ACTIVE'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown filter: '</span> <span class="token operator">+</span> filter<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// mapStateToProps会订阅 Store，每当state更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</span>

<span class="token comment">// mapStateToProps的第一个参数总是state对象，还可以使用第二个参数，代表容器组件的props对象。</span>

<span class="token comment">// 容器组件的代码</span>
<span class="token comment">//    &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;</span>
<span class="token comment">//      All</span>
<span class="token comment">//    &lt;/FilterLink&gt;</span>

<span class="token comment">// 使用ownProps作为参数后，如果容器组件的参数发生变化，也会引发 UI 组件重新渲染。</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">active</span><span class="token operator">:</span> ownProps<span class="token punctuation">.</span>filter <span class="token operator">===</span> state<span class="token punctuation">.</span>visibilityFilter
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// connect方法可以省略mapStateToProps参数，那样的话，UI 组件就不会订阅Store，就是说 Store 的更新不会引起 UI 组件的更新。</span>
</code></pre></div><h3 id="react-redux用法-mapdispatchtoprops"><a href="#react-redux用法-mapdispatchtoprops" class="header-anchor">#</a> React-Redux用法-mapDispatchToProps()</h3> <ul><li>mapDispatchToProps是connect函数的第二个参数，用来建立 UI 组件的参数到store.dispatch方法的映射。也就是说，它定义了哪些用户的操作应该当作 Action，传给 Store。它可以是一个函数，也可以是一个对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 如果mapDispatchToProps是一个函数，会得到dispatch和ownProps（容器组件的props对象）两个参数。</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token parameter">dispatch<span class="token punctuation">,</span>
  ownProps</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filter</span><span class="token operator">:</span> ownProps<span class="token punctuation">.</span>filter
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// mapDispatchToProps作为函数，应该返回一个对象，该对象的每个键值对都是一个映射，定义了 UI 组件的参数怎样发出 Action。</span>


<span class="token comment">// 如果mapDispatchToProps是一个对象，它的每个键名也是对应 UI 组件的同名参数，键值应该是一个函数，会被当作 Action creator ，返回的 Action 会由 Redux 自动发出。</span>
<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">filter</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'SET_VISIBILITY_FILTER'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filter</span><span class="token operator">:</span> filter
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-redux用法-provider-组件"><a href="#react-redux用法-provider-组件" class="header-anchor">#</a> React-Redux用法-Provider 组件</h3> <ul><li>让容器组件拿到state: connect方法生成容器组件以后，需要让容器组件拿到state对象，才能生成 UI 组件的参数。一种解决方法是将state对象作为参数，传入容器组件。但是，这样做比较麻烦，尤其是容器组件可能在很深的层级，一级级将state传下去就很麻烦。React-Redux 提供Provider组件，可以让容器组件拿到state。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Provider在根组件外面包了一层，这样一来，App的所有子组件就默认都可以拿到state了。</span>

<span class="token comment">// 它的原理是React组件的context属性</span>

<span class="token comment">// store放在了上下文对象context上面。然后，子组件就可以从context拿到store</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> todoApp <span class="token keyword">from</span> <span class="token string">'./reducers'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./components/App'</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todoApp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="react-redux用法-实例-计数器"><a href="#react-redux用法-实例-计数器" class="header-anchor">#</a> React-Redux用法-实例：计数器</h3> <ul><li>1、计数器组件，它是一个纯的 UI 组件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这个 UI 组件有两个参数：value和onIncreaseClick。前者需要从state计算得到，后者需要向外发出 Action。</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> onIncreaseClick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncreaseClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>Increase<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>2、定义value到state的映射，以及onIncreaseClick到dispatch的映射。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onIncreaseClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>increaseAction<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Action Creator</span>
<span class="token keyword">const</span> increaseAction <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increase'</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li>3、使用connect方法生成容器组件。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
</code></pre></div><ul><li>4、定义这个组件的 Reducer。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Reducer</span>
<span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> state<span class="token punctuation">.</span>count
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increase'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>5、生成store对象，并使用Provider在根组件外面包一层</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> loadState<span class="token punctuation">,</span> saveState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./localStorage'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> persistedState <span class="token operator">=</span> <span class="token function">loadState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  todoApp<span class="token punctuation">,</span>
  persistedState
<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">saveState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="redux完整示例"><a href="#redux完整示例" class="header-anchor">#</a> redux完整示例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token comment">// React component</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> onIncreaseClick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncreaseClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>Increase<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Counter<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  <span class="token literal-property property">onIncreaseClick</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired
<span class="token punctuation">}</span>

<span class="token comment">// Action</span>
<span class="token keyword">const</span> increaseAction <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increase'</span> <span class="token punctuation">}</span>

<span class="token comment">// Reducer</span>
<span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> state<span class="token punctuation">.</span>count
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increase'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>

<span class="token comment">// Map Redux state to component props</span>
<span class="token keyword">function</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Map Redux actions to component props</span>
<span class="token keyword">function</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onIncreaseClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>increaseAction<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Connected Component</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="react-钩子-react-的两套-api"><a href="#react-钩子-react-的两套-api" class="header-anchor">#</a> React 钩子-React 的两套 API</h3> <ul><li>类（class）API 和基于函数的钩子（hooks） API</li> <li>官方推荐使用钩子（函数），而不是类。因为钩子更简洁，代码量少，用起来比较&quot;轻&quot;，而类比较&quot;重&quot;。而且，钩子是函数，更符合 React 函数式的本质。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 任何一个组件，可以用类来写，也可以用钩子来写</span>
<span class="token comment">// 类的写法。</span>
<span class="token keyword">class</span> <span class="token class-name">Welcome</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 钩子的写法，也就是函数。</span>
<span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-钩子-类和函数的差异"><a href="#react-钩子-类和函数的差异" class="header-anchor">#</a> React 钩子-类和函数的差异</h3> <p>类组件和函数组件是有差异的。不同的写法，代表了不同的编程方法论:</p> <ul><li><p>类（class）是数据和逻辑的封装。 也就是说，组件的状态和操作方法是封装在一起的。如果选择了类的写法，就应该把相关的数据和操作，都写在同一个 class 里面。
class ---&gt; Methods + Variable</p></li> <li><p>函数一般来说，只应该做一件事，就是返回一个值。 如果你有多个操作，每个操作应该写成一个单独的函数。而且，数据的状态应该与操作方法分离。根据这种理念，React 的函数组件只应该做一件事情：返回组件的 HTML 代码，而没有其他的功能。</p></li></ul> <p>input x ---&gt; Function f ---&gt; output x</p> <ul><li>这个函数只做一件事，就是根据输入的参数，返回组件的 HTML 代码。这种只进行单纯的数据计算（换算）的函数，在函数式编程里面称为 &quot;纯函数&quot;（pure function）。</li></ul> <h3 id="react-钩子-副效应是什么"><a href="#react-钩子-副效应是什么" class="header-anchor">#</a> React 钩子-副效应是什么？</h3> <ul><li><p>疑问：如果纯函数只能进行数据计算，那些不涉及计算的操作（比如生成日志、储存数据、改变应用状态等等）应该写在哪里呢？</p></li> <li><p>函数式编程将那些跟数据计算无关的操作，都称为 &quot;副效应&quot; （side effect） 。如果函数内部直接包含产生副效应的操作，就不再是纯函数了，我们称之为不纯的函数。</p></li> <li><p>纯函数内部只有通过间接的手段（即通过其他函数调用），才能包含副效应。</p></li></ul> <h3 id="react-钩子-钩子-hook-的作用"><a href="#react-钩子-钩子-hook-的作用" class="header-anchor">#</a> React 钩子-钩子（hook）的作用</h3> <ul><li><p>钩子（hook）就是 React 函数组件的副效应解决方案，用来为函数组件引入副效应。</p></li> <li><p>函数组件的主体只应该用来返回组件的 HTML 代码，所有的其他操作（副效应）都必须通过钩子引入。</p></li> <li><p>由于副效应非常多，所以钩子有许多种。React 为许多常见的操作（副效应），都提供了专用的钩子。</p> <ul><li>useState()：保存状态</li> <li>useContext()：保存上下文</li> <li>useRef()：保存引用</li> <li>......</li></ul></li> <li><p>上面这些钩子，都是引入某种特定的副效应，而 <code>useEffect()</code> 是通用的副效应钩子 。找不到对应的钩子时，就可以用它。其实，从名字也可以看出来，它跟副效应（side effect）直接相关。</p></li></ul> <h3 id="react-钩子-useeffect-的用法"><a href="#react-钩子-useeffect-的用法" class="header-anchor">#</a> React 钩子-useEffect() 的用法</h3> <ul><li>useEffect()本身是一个函数，由 React 框架提供，在函数组件内部调用即可。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 举例来说，我们希望组件加载以后，网页标题（document.title）会随之改变。那么，改变网页标题这个操作，就是组件的副效应，必须通过useEffect()来实现。</span>
<span class="token comment">// 组件加载以后，React 就会执行这个函数</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// useEffect()的参数是一个函数，它就是所要完成的副效应（改变网页标题）</span>
<span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'加载完成'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// useEffect()的作用就是指定一个副效应函数，组件每渲染一次，该函数就自动执行一次。组件首次在网页 DOM 加载后，副效应函数也会执行。</span>
</code></pre></div><h3 id="react-钩子-useeffect-的第二个参数"><a href="#react-钩子-useeffect-的第二个参数" class="header-anchor">#</a> React 钩子-useEffect() 的第二个参数</h3> <ul><li>有时候，我们不希望useEffect()每次渲染都执行，这时可以使用它的第二个参数，使用一个数组指定副效应函数的依赖项，只有依赖项发生变化，才会重新渲染。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useEffect()的第二个参数是一个数组，指定了第一个参数（副效应函数）的依赖项（props.name）。只有该变量发生变化时，副效应函数才会执行。</span>
<span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 如果第二个参数是一个空数组，就表明副效应参数没有任何依赖项。因此，副效应函数这时只会在组件加载进入 DOM 后执行一次，后面组件重新渲染，就不会再次执行。</span>
<span class="token comment">// 这很合理，由于副效应不依赖任何变量，所以那些变量无论怎么变，副效应函数的执行结果都不会改变，所以运行一次就够了。</span>
</code></pre></div><h3 id="react-钩子-useeffect-的用途"><a href="#react-钩子-useeffect-的用途" class="header-anchor">#</a> React 钩子-useEffect() 的用途</h3> <p>只要是副效应，都可以使用useEffect()引入。它的常见用途有下面几种。</p> <ul><li>获取数据（data fetching）</li> <li>事件监听或订阅（setting up a subscription）</li> <li>改变 DOM（changing the DOM）</li> <li>输出日志（logging）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// useState()用来生成一个状态变量（data），保存获取的数据；</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// useEffect()的副效应函数内部有一个 async 函数，用来从服务器异步获取数据。</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>
        <span class="token string">'https://hn.algolia.com/api/v1/search?query=redux'</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 拿到数据以后，再用setData()触发组件的重新渲染。</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 由于获取数据只需要执行一次，所以上例的useEffect()的第二个参数为一个空数组。</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>data<span class="token punctuation">.</span>hits<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>objectID<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>url<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><h3 id="react-钩子-useeffect-的返回值"><a href="#react-钩子-useeffect-的返回值" class="header-anchor">#</a> React 钩子-useEffect() 的返回值</h3> <ul><li><p>副效应是随着组件加载而发生的，那么组件卸载时，可能需要清理这些副效应。</p></li> <li><p>useEffect()允许返回一个函数，在组件卸载时，执行该函数，清理副效应。如果不需要清理副效应，useEffect()就不用返回任何值。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useEffect()在组件加载时订阅了一个事件，并且返回一个清理函数，在组件卸载时取消订阅。</span>
<span class="token comment">// 实际使用中，由于副效应函数默认是每次渲染都会执行，所以清理函数不仅会在组件卸载时执行一次，每次副效应函数重新执行之前，也会执行一次，用来清理上一次渲染的副效应。</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> subscription <span class="token operator">=</span> props<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>source<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react-钩子-useeffect-的注意点"><a href="#react-钩子-useeffect-的注意点" class="header-anchor">#</a> React 钩子-useEffect() 的注意点</h3> <ul><li>使用useEffect()时，有一点需要注意。如果有多个副效应，应该调用多个useEffect()，而不应该合并写在一起。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>varA<span class="token punctuation">,</span> setVarA<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>varB<span class="token punctuation">,</span> setVarB<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setVarA</span><span class="token punctuation">(</span>varA <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>varA<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setVarB</span><span class="token punctuation">(</span>varB <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>varB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>varA<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>varB<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-hooks-组件类的缺点"><a href="#react-hooks-组件类的缺点" class="header-anchor">#</a> React Hooks-组件类的缺点</h3> <ul><li>React 的核心是组件。v16.8 版本之前，组件的标准写法是类（class）。其缺点：代码太重
<ul><li>大型组件很难拆分和重构，也很难测试。</li> <li>业务逻辑分散在组件的各个方法之中，导致重复逻辑或关联逻辑。</li> <li>组件类引入了复杂的编程模式，比如 render props 和高阶组件。</li></ul></li></ul> <h3 id="react-hooks-函数组件"><a href="#react-hooks-函数组件" class="header-anchor">#</a> React Hooks-函数组件</h3> <ul><li><p>组件的最佳写法应该是函数，而不是类。但是，这种写法有重大限制，必须是纯函数，不能包含状态，也不支持生命周期方法，因此无法取代类。</p></li> <li><p>React Hooks 的设计目的，就是加强版函数组件，完全不使用&quot;类&quot;，就能写出一个全功能的组件。</p></li></ul> <h3 id="react-hooks-hook-的含义"><a href="#react-hooks-hook-的含义" class="header-anchor">#</a> React Hooks-Hook 的含义</h3> <ul><li><p>React Hooks 的意思是，组件尽量写成纯函数，如果需要外部功能和副作用，就用钩子把外部代码&quot;钩&quot;进来。 React Hooks 就是那些钩子。</p></li> <li><p>React 默认提供了一些常用钩子，你也可以封装自己的钩子。</p></li> <li><p>所有的钩子都是为函数引入外部功能，所以 React 约定，钩子一律使用use前缀命名，便于识别。</p></li> <li><p>下面介绍 React 默认提供的四个最常用的钩子。</p> <ul><li>useState()</li> <li>useContext()</li> <li>useReducer()</li> <li>useEffect()</li></ul></li></ul> <h3 id="react-hooks-usestate-状态钩子"><a href="#react-hooks-usestate-状态钩子" class="header-anchor">#</a> React Hooks-useState()：状态钩子</h3> <ul><li>useState()用于为函数组件引入状态（state）。纯函数不能有状态，所以把状态放在钩子里面。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useState()这个函数：接受状态的初始值，作为参数</span>
<span class="token comment">// useState()这个函数：返回一个数组，数组的第一个成员是一个变量（上例是buttonText），指向状态的当前值。第二个成员是一个函数，用来更新状态，约定是set前缀加上状态的变量名（上例是setButtonText）。</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span>  <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
  <span class="token keyword">const</span>  <span class="token punctuation">[</span>buttonText<span class="token punctuation">,</span> setButtonText<span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;Click me,   please&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">setButtonText</span><span class="token punctuation">(</span><span class="token string">&quot;Thanks, been clicked!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span>  <span class="token operator">&lt;</span>button  onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>buttonText<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-hooks-usecontext-共享状态钩子"><a href="#react-hooks-usecontext-共享状态钩子" class="header-anchor">#</a> React Hooks-useContext()：共享状态钩子</h3> <ul><li>需要在组件之间共享状态，可以使用useContext()。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 有两个组件 Navbar 和 Messages，我们希望它们之间共享状态。</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Navbar<span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Messages<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token comment">// 第一步就是使用 React Context API，在组件外部建立一个 Context。</span>
<span class="token keyword">const</span> AppContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 组件封装代码如下</span>
<span class="token comment">// AppContext.Provider提供了一个 Context 对象，这个对象可以被子组件共享。</span>
<span class="token operator">&lt;</span>AppContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
  <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'superawesome'</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Navbar<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Messages<span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>AppContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>

<span class="token comment">// Navbar 组件的代码如下</span>
<span class="token comment">// useContext()钩子函数用来引入 Context 对象，从中获取username属性。</span>
<span class="token keyword">const</span> <span class="token function-variable function">Navbar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> username <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;navbar&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>AwesomeSite<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Message 组件的代码也类似。</span>
<span class="token comment">// useContext()钩子函数用来引入 Context 对象，从中获取username属性。</span>
<span class="token keyword">const</span> <span class="token function-variable function">Messages</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> username <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;messages&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Messages<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">1</span> message <span class="token keyword">for</span> <span class="token punctuation">{</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">&quot;message&quot;</span><span class="token operator">&gt;</span>useContext is awesome<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="react-hooks-usereducer-action-钩子"><a href="#react-hooks-usereducer-action-钩子" class="header-anchor">#</a> React Hooks-useReducer()：action 钩子</h3> <ul><li><p>React 本身不提供状态管理功能，通常需要使用外部库。这方面最常用的库是 Redux。Redux 的核心概念是，组件发出 action 与状态管理器通信。状态管理器收到 action 以后，使用 Reducer 函数算出新的状态，Reducer 函数的形式是(state, action) =&gt; newState。</p></li> <li><p>useReducers()钩子用来引入 Reducer 功能。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useReducer()的基本用法，它接受 Reducer 函数和状态的初始值作为参数，返回一个数组。数组的第一个成员是状态的当前值，第二个成员是发送 action 的dispatch函数。</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 计数器的例子。用于计算状态的 Reducer 函数如下。</span>
<span class="token keyword">const</span> <span class="token function-variable function">myReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">case</span><span class="token punctuation">(</span><span class="token string">'countUp'</span><span class="token punctuation">)</span><span class="token operator">:</span>
      <span class="token keyword">return</span>  <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span>  state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 组件代码如下</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span>   <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span>  <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'countUp'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">+</span><span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Count<span class="token operator">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于 Hooks 可以提供共享状态和 Reducer 函数，所以它在这些方面可以取代 Redux。但是，它没法提供中间件（middleware）和时间旅行（time travel），如果你需要这两个功能，还是要用 Redux。</p></div> <h3 id="react-hooks-useeffect-副作用钩子"><a href="#react-hooks-useeffect-副作用钩子" class="header-anchor">#</a> React Hooks-useEffect()：副作用钩子</h3> <ul><li>useEffect()用来引入具有副作用的操作，最常见的就是向服务器请求数据。以前，放在componentDidMount里面的代码，现在可以放在useEffect()。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useEffect()接受两个参数。</span>
    <span class="token comment">// 第一个参数是一个函数，异步操作的代码放在里面</span>
    <span class="token comment">// 第二个参数是一个数组，用于给出 Effect 的依赖项，只要这个数组发生变化，useEffect()就会执行。</span>
    <span class="token comment">// 第二个参数可以省略，这时每次组件渲染时，就会执行useEffect()。</span>
<span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> personId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>person<span class="token punctuation">,</span> setPerson<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.co/api/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>personId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setPerson</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>personId<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Loading <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You're viewing<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Height<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>height<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Mass<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>mass<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 上面代码中，每当组件参数personId发生变化，useEffect()就会执行。组件第一次渲染时，useEffect()也会执行。   </span>
</code></pre></div><h3 id="react-hooks-创建自己的-hooks"><a href="#react-hooks-创建自己的-hooks" class="header-anchor">#</a> React Hooks-创建自己的 Hooks</h3> <ul><li>Hooks 代码还可以封装起来，变成一个自定义的 Hook，便于共享。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 封装hook,usePerson()就是一个自定义的 Hook。</span>
<span class="token keyword">const</span> <span class="token function-variable function">usePerson</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">personId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>person<span class="token punctuation">,</span> setPerson<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://swapi.co/api/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>personId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setPerson</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>personId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">return</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> person<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Person 组件改用这个新的钩子，引入封装的逻辑</span>
<span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> personId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> person<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">usePerson</span><span class="token punctuation">(</span>personId<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Loading <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>You're viewing<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Height<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>height<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Mass<span class="token operator">:</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>mass<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="umi3-使用-dva"><a href="#umi3-使用-dva" class="header-anchor">#</a> umi3 使用 dva</h3> <p>技术架构：Ts、dva、</p> <p>dva中主要分3层，models,services,components,其中models是最重要概念，这里放的是各种数据，与数据交互的应该都是在这里。services是请求后台接口的方法。components是组件了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// model的基本结构</span>
<span class="token punctuation">{</span>   
  <span class="token literal-property property">namespace</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token comment">// 命名空间名字，必填     </span>
  <span class="token comment">//namespace: 'global' 说明以下此处的dva命名空间为 global，即你调用的时候需要采用 global.XXX 的形式   </span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token comment">// 状态   </span>
  <span class="token literal-property property">reducer</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token comment">// 同步更新 state 修改状态  </span>
  <span class="token literal-property property">effects</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token comment">// 副作用：处理异步逻辑     </span>
  <span class="token comment">//当数据需要从服务器获取时，需要发起异步请求，请求到数据之后，通过调用 Reducers更新数据到全局state   </span>
  <span class="token literal-property property">subscriptions</span><span class="token operator">:</span> Object <span class="token comment">// 订阅数据源</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>1、reducer：用来处理同步操作。如果不需要调接口时候，我们前台传递的 action可以直接调用 reducers里的方法。</p> <ul><li>reducer是一个函数，接收state 和 action，返回老的或新的state。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> …state<span class="token punctuation">,</span> …action<span class="token punctuation">.</span>payload <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>state:为当前 Model 下的所有 state 值</li> <li>action:当前台页面需要进行数据操作时，就会创建一个 action,action 存放了传递过来需要对当前 state 进行改变的数据。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">reducers</span><span class="token operator">:</span><span class="token punctuation">{</span>
<span class="token function">changeTitle</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> num <span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token comment">//changeTitle可以理解为一个方法名 </span>
  <span class="token comment">//payload:就是 action 里传递过来的数据。</span>
  <span class="token comment">//num 是传过来的，名字随便起，不是state中的num，这接收一个action</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span><span class="token operator">...</span>num<span class="token punctuation">}</span>
  <span class="token comment">//return：返回的是新的 state。等于舍弃了旧的 state,重新 return 一个新的 state 作为当前 Model 的 state。</span>
  <span class="token comment">//一般情况下，我们要解开旧的 state,将它重新赋值给新的 state。...state 为 ES6 语法。</span>
  <span class="token comment">//将操作完成得数据累加到 return 中。</span>
  <span class="token comment">//同名的数据会覆盖，所以不用担心旧的 state 值会影响到新设置的值。</span>
  <span class="token comment">//不同名的数据会追加。</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>页面调用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//页面使用dispatch进行使用</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'pageModel/changeTitle'</span><span class="token punctuation">,</span>  <span class="token comment">//namespace+需要调用的reducer方法</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>2、effects：用来处理异步操作。如果需要调取接口的话，前台页面就需要调用 effects 里的方法。</p> <ul><li>将数据取出来，在传递给 reducers 里的方法进行数据操作和同步 state。</li> <li>Dva 中的异步操作都放到 effects 中管理，基于 Redux-saga 实现 Effect 是一个 Generator函数，内部使用 yield 关键字，标识每一步的操作</li> <li>每一个 effect 都可以接收两个参数：
<ul><li>包含 dispatch 携带参数 payload 的 action 对象</li> <li>dva 提供的 effect 函数内部的处理函数集。【常用的有 call: 执行异步函数、put: 发出一个 Action类似于
dispatch 触发reducer改变state、select: 返回 model 中的 state //用于从state里获取数据】</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.call</span>
  <span class="token operator">*</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//deleteOne方法名，payload是传来的参数，是个对象，如果没参数可以写成{_,{call, put}}</span>
  <span class="token comment">//*:这个 * 符号，可能小伙伴们不熟悉，简单点，只要记住每个 effects 里方法前面都加上 * 即可。</span>
  <span class="token comment">//(这表明它是一个异步函数，里面可以使用 yield 等待其他异步函数执行结果。)</span>

  <span class="token comment">//payload:当前台页面需要进行数据操作时，就会创建一个 action,</span>
  <span class="token comment">//action 存放了传递过来需要对当前 state 进行改变的数据。</span>
  <span class="token comment">//payload 就是存放在 action 里面的数据。</span>
  <span class="token keyword">const</span> rsp <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>cardsService<span class="token punctuation">.</span>deleteOne<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">num</span><span class="token operator">:</span>payload<span class="token punctuation">.</span>numCount<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//call:与后台服务端接口进行交互。</span>
  <span class="token comment">//第一个传参：后台服务器接口对应的名称。第二个参数：入参。</span>
  <span class="token comment">//cardsService是引入service层那个js的一个名字，num是后台要求传的参数，rsp就是后台返回来的数据</span>
  <span class="token comment">// 请求成功之后，调用 reducer 更新 state</span>

  <span class="token function">service中异步请求</span><span class="token punctuation">(</span>cardsService<span class="token punctuation">.</span>js<span class="token punctuation">)</span>
  <span class="token comment">// request 是封装的一个网络请求库  </span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;queryFromApi&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;payload&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2.select</span>
  <span class="token operator">*</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
　　 effects<span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>test<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
      <span class="token comment">//select就是用来选择上面state里的数据</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 3.put</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  　type<span class="token operator">:</span> <span class="token string">&quot;addNum&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// put:用来发出事件，即 action。一般调用 reducers 下的方法进行同步数据。</span>
    <span class="token comment">//type:该 Model 层里 reducers 下的方法名。</span>
    <span class="token comment">//payload:参数的传递。</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    　 num<span class="token operator">:</span> data<span class="token punctuation">,</span> 
      <span class="token comment">// 把后台返回的数据赋值给了num</span>
      <span class="token comment">//假如那个reducer中方法是由这里effects去触发的，那个num名必须是这里名字num，如果reducer中方法不是这触发，那名字可随便起</span>
      <span class="token keyword">return</span> rsp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>3、subscriptions：订阅监听，比如我们监听路由，进入页面就如何</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> history<span class="token punctuation">,</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
　<span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>
　　<span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> search<span class="token punctuation">,</span> query<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
　　　<span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token operator">===</span><span class="token string">&quot;/testdemo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 当进入testdemo这路由，就会触发fetchUser方法</span>
　　　　<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;fetchUser&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
　　　<span class="token punctuation">}</span>
　<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>4、connect：connect 连接 Model 和 Route 页面下的数据</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dva 有提供 connect 方法。只要在每个 Routes 页面导入下面的代码即可。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>

<span class="token comment">// 对于组件：我们在最后导出时使用 connect 进行与 Models 的连接。</span>
<span class="token comment">// index 为 Model 层里面的 namespace。命名空间</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>IndexPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>5、前台调用 Model 层方法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span> 
<span class="token comment">//在 dva 中，可以通过 `this.props` 直接取得 `dispatch`</span>
<span class="token function">dispatch</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'example/fetch'</span><span class="token punctuation">,</span>  <span class="token comment">//指定哪个 model 层里面的哪个 方法</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'exampleNew'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token comment">//需要传递到 model 层里面的参数。</span>
  <span class="token comment">//payload 为固定用法(我自己的理解)。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// parame和query传值:</span>
<span class="token comment">// query更加类似于我们ajax中get传参，params则类似于post，说的再简单一点，前者在浏览器地址栏中显示参数，后者则不显示</span>
</code></pre></div><ul><li><a href="https://github.com/dvajs/dva/blob/master/README_zh-CN.md" target="_blank" rel="noopener noreferrer">dva github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.ahwgs.cn/ruheshiyongdvayufuwuduanjinxingshujujiaohu.html" target="_blank" rel="noopener noreferrer">使用dva与服务端进行数据交互<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="react-native"><a href="#react-native" class="header-anchor">#</a> react native</h2> <h2 id="next-ssr"><a href="#next-ssr" class="header-anchor">#</a> Next ssr</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/foreverwaiting/easy-bookmark/edit/master/docs/blogs/react.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/8/2021, 12:52:13 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/easy-bookmark/blogs/others.html" class="prev">
        其他
      </a></span> <span class="next"><a href="/easy-bookmark/blogs/safe.html">
        前端安全
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/easy-bookmark/assets/js/app.98929521.js" defer></script><script src="/easy-bookmark/assets/js/2.6ed84ef8.js" defer></script><script src="/easy-bookmark/assets/js/19.cb360c51.js" defer></script>
  </body>
</html>
