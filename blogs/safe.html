<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端安全 | easy bookmark</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/easy-bookmark/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?d517a1ee1e75b0fd216b5183a8f32ac0";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();      
      </script>
    <meta name="description" content="个人收藏">
    
    <link rel="preload" href="/easy-bookmark/assets/css/0.styles.9b6bb25f.css" as="style"><link rel="preload" href="/easy-bookmark/assets/js/app.98929521.js" as="script"><link rel="preload" href="/easy-bookmark/assets/js/2.6ed84ef8.js" as="script"><link rel="preload" href="/easy-bookmark/assets/js/20.469dd230.js" as="script"><link rel="prefetch" href="/easy-bookmark/assets/js/10.59e2f598.js"><link rel="prefetch" href="/easy-bookmark/assets/js/11.9fc8a230.js"><link rel="prefetch" href="/easy-bookmark/assets/js/12.089b352b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/13.e2ac9449.js"><link rel="prefetch" href="/easy-bookmark/assets/js/14.a988d92c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/15.ae6ad2bb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/16.416459c2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/17.3aa5cbce.js"><link rel="prefetch" href="/easy-bookmark/assets/js/18.b724b90f.js"><link rel="prefetch" href="/easy-bookmark/assets/js/19.cb360c51.js"><link rel="prefetch" href="/easy-bookmark/assets/js/21.62b9147c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/22.dabef7dd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/23.ffa9fcfd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/24.a4781c35.js"><link rel="prefetch" href="/easy-bookmark/assets/js/25.79ef71a6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/26.331c4dc5.js"><link rel="prefetch" href="/easy-bookmark/assets/js/27.5b1f1b94.js"><link rel="prefetch" href="/easy-bookmark/assets/js/28.37dd571e.js"><link rel="prefetch" href="/easy-bookmark/assets/js/29.580f58e7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/3.24a9cbfa.js"><link rel="prefetch" href="/easy-bookmark/assets/js/30.0630daa0.js"><link rel="prefetch" href="/easy-bookmark/assets/js/31.172b9e48.js"><link rel="prefetch" href="/easy-bookmark/assets/js/32.3c9adea6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/33.5595eb88.js"><link rel="prefetch" href="/easy-bookmark/assets/js/34.931e4ffe.js"><link rel="prefetch" href="/easy-bookmark/assets/js/35.c06f071e.js"><link rel="prefetch" href="/easy-bookmark/assets/js/36.bc28c146.js"><link rel="prefetch" href="/easy-bookmark/assets/js/37.50b96313.js"><link rel="prefetch" href="/easy-bookmark/assets/js/38.61fdc3da.js"><link rel="prefetch" href="/easy-bookmark/assets/js/39.8e94008c.js"><link rel="prefetch" href="/easy-bookmark/assets/js/4.5591ca6b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/40.b9dd3fe7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/41.44f4e080.js"><link rel="prefetch" href="/easy-bookmark/assets/js/42.cf495ac2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/43.96432862.js"><link rel="prefetch" href="/easy-bookmark/assets/js/44.28acc21b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/45.10534c91.js"><link rel="prefetch" href="/easy-bookmark/assets/js/46.6d79e8a6.js"><link rel="prefetch" href="/easy-bookmark/assets/js/47.a7759570.js"><link rel="prefetch" href="/easy-bookmark/assets/js/48.bc0667ab.js"><link rel="prefetch" href="/easy-bookmark/assets/js/49.c1ebffce.js"><link rel="prefetch" href="/easy-bookmark/assets/js/5.3de96ffc.js"><link rel="prefetch" href="/easy-bookmark/assets/js/50.a0f50760.js"><link rel="prefetch" href="/easy-bookmark/assets/js/51.52913321.js"><link rel="prefetch" href="/easy-bookmark/assets/js/52.b2c32e3a.js"><link rel="prefetch" href="/easy-bookmark/assets/js/53.cd133ce2.js"><link rel="prefetch" href="/easy-bookmark/assets/js/54.5becf481.js"><link rel="prefetch" href="/easy-bookmark/assets/js/55.3ec180c8.js"><link rel="prefetch" href="/easy-bookmark/assets/js/56.24bf3181.js"><link rel="prefetch" href="/easy-bookmark/assets/js/57.5edd1dc7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/58.697b6057.js"><link rel="prefetch" href="/easy-bookmark/assets/js/59.c422bbd3.js"><link rel="prefetch" href="/easy-bookmark/assets/js/6.010a5dd5.js"><link rel="prefetch" href="/easy-bookmark/assets/js/60.b44a3b13.js"><link rel="prefetch" href="/easy-bookmark/assets/js/61.36d0c1bd.js"><link rel="prefetch" href="/easy-bookmark/assets/js/62.e4917905.js"><link rel="prefetch" href="/easy-bookmark/assets/js/63.690191bf.js"><link rel="prefetch" href="/easy-bookmark/assets/js/64.e6e01d48.js"><link rel="prefetch" href="/easy-bookmark/assets/js/65.13387ea7.js"><link rel="prefetch" href="/easy-bookmark/assets/js/66.37c48ee9.js"><link rel="prefetch" href="/easy-bookmark/assets/js/67.fa7e4f5a.js"><link rel="prefetch" href="/easy-bookmark/assets/js/68.eb40d0ee.js"><link rel="prefetch" href="/easy-bookmark/assets/js/69.584d43ea.js"><link rel="prefetch" href="/easy-bookmark/assets/js/7.48552666.js"><link rel="prefetch" href="/easy-bookmark/assets/js/70.3abc29fb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/71.e149adad.js"><link rel="prefetch" href="/easy-bookmark/assets/js/72.b73ecb17.js"><link rel="prefetch" href="/easy-bookmark/assets/js/73.9307c017.js"><link rel="prefetch" href="/easy-bookmark/assets/js/74.c1502fb4.js"><link rel="prefetch" href="/easy-bookmark/assets/js/75.69f4626b.js"><link rel="prefetch" href="/easy-bookmark/assets/js/76.c25802cb.js"><link rel="prefetch" href="/easy-bookmark/assets/js/77.a37efc00.js"><link rel="prefetch" href="/easy-bookmark/assets/js/8.a079a873.js"><link rel="prefetch" href="/easy-bookmark/assets/js/9.e1d2376d.js">
    <link rel="stylesheet" href="/easy-bookmark/assets/css/0.styles.9b6bb25f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/easy-bookmark/" class="home-link router-link-active"><img src="/easy-bookmark/logo.jpg" alt="easy bookmark" class="logo"> <span class="site-name can-hide">easy bookmark</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/easy-bookmark/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/easy-bookmark/blogs/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/easy-bookmark/website/" class="nav-link">
  网站
</a></div><div class="nav-item"><a href="/easy-bookmark/daily/" class="nav-link">
  日常
</a></div><div class="nav-item"><a href="/easy-bookmark/front/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/easy-bookmark/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://foreverwaiting.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/foreverwaiting/easy-bookmark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/easy-bookmark/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/easy-bookmark/blogs/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/easy-bookmark/website/" class="nav-link">
  网站
</a></div><div class="nav-item"><a href="/easy-bookmark/daily/" class="nav-link">
  日常
</a></div><div class="nav-item"><a href="/easy-bookmark/front/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/easy-bookmark/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://foreverwaiting.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  hexo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/foreverwaiting/easy-bookmark" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/easy-bookmark/blogs/Article.html" class="sidebar-link">好的文章</a></li><li><a href="/easy-bookmark/blogs/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/easy-bookmark/blogs/ES6.html" class="sidebar-link">ES6</a></li><li><a href="/easy-bookmark/blogs/Javascript.html" class="sidebar-link">Javascript</a></li><li><a href="/easy-bookmark/blogs/MicroService.html" class="sidebar-link">微服务</a></li><li><a href="/easy-bookmark/blogs/" aria-current="page" class="sidebar-link">态度</a></li><li><a href="/easy-bookmark/blogs/TS.html" class="sidebar-link">typescript</a></li><li><a href="/easy-bookmark/blogs/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/easy-bookmark/blogs/mdn.html" class="sidebar-link">MDN JavaScript</a></li><li><a href="/easy-bookmark/blogs/node.html" class="sidebar-link">node</a></li><li><a href="/easy-bookmark/blogs/others.html" class="sidebar-link">其他</a></li><li><a href="/easy-bookmark/blogs/react.html" class="sidebar-link">react 学习</a></li><li><a href="/easy-bookmark/blogs/safe.html" aria-current="page" class="active sidebar-link">前端安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#跨站脚本攻击-cross-sites-script" class="sidebar-link">跨站脚本攻击（Cross Sites Script）</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#跨站点请求伪造-cross-sites-request-forgery" class="sidebar-link">跨站点请求伪造（Cross Sites Request Forgery）</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#点击劫持-clickjacking" class="sidebar-link">点击劫持（ClickJacking）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#点击劫持防御方式" class="sidebar-link">点击劫持防御方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#其他安全问题" class="sidebar-link">其他安全问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#跨域问题处理" class="sidebar-link">跨域问题处理</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#postmessage-跨窗口传递信息" class="sidebar-link">postMessage 跨窗口传递信息</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#web-storage" class="sidebar-link">Web Storage</a></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#跨域问题处理-2" class="sidebar-link">跨域问题处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/easy-bookmark/blogs/safe.html#网页安全政策-content-security-policy-缩写-csp" class="sidebar-link">&quot;网页安全政策&quot;（Content Security Policy，缩写 CSP）</a></li></ul></li></ul></li><li><a href="/easy-bookmark/blogs/vue.html" class="sidebar-link">vue</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端安全"><a href="#前端安全" class="header-anchor">#</a> 前端安全</h1> <p>待完善。。。</p> <ul><li>web中可能存在的安全漏洞以及如何去检测这些安全漏洞，如何去防范潜在的恶意攻击</li></ul> <h2 id="跨站脚本攻击-cross-sites-script"><a href="#跨站脚本攻击-cross-sites-script" class="header-anchor">#</a> 跨站脚本攻击（Cross Sites Script）</h2> <h2 id="跨站点请求伪造-cross-sites-request-forgery"><a href="#跨站点请求伪造-cross-sites-request-forgery" class="header-anchor">#</a> 跨站点请求伪造（Cross Sites Request Forgery）</h2> <h2 id="点击劫持-clickjacking"><a href="#点击劫持-clickjacking" class="header-anchor">#</a> 点击劫持（ClickJacking）</h2> <h3 id="点击劫持防御方式"><a href="#点击劫持防御方式" class="header-anchor">#</a> 点击劫持防御方式</h3> <h2 id="其他安全问题"><a href="#其他安全问题" class="header-anchor">#</a> 其他安全问题</h2> <h3 id="跨域问题处理"><a href="#跨域问题处理" class="header-anchor">#</a> 跨域问题处理</h3> <h3 id="postmessage-跨窗口传递信息"><a href="#postmessage-跨窗口传递信息" class="header-anchor">#</a> postMessage 跨窗口传递信息</h3> <h3 id="web-storage"><a href="#web-storage" class="header-anchor">#</a> Web Storage</h3> <h3 id="跨域问题处理-2"><a href="#跨域问题处理-2" class="header-anchor">#</a> 跨域问题处理</h3> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>谨慎用户输入信息，进行输入检查（客户端和服务端同时检查）</li> <li>在变量输出到HTML页面时，都应该进行编码或转义来预防XSS攻击</li> <li>该用验证码的时候一定要添上</li> <li>尽量在重要请求上添加Token参数，注意Token要足够随机，用足够安全的随机数生成算法</li></ul> <h3 id="网页安全政策-content-security-policy-缩写-csp"><a href="#网页安全政策-content-security-policy-缩写-csp" class="header-anchor">#</a> &quot;网页安全政策&quot;（Content Security Policy，缩写 CSP）</h3> <ul><li><p>1、目的：解决跨域脚本攻击 XSS 是最常见、危害最大的网页安全漏洞。</p></li> <li><p>2、实质：CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。</p></li> <li><p>3、启用 CSP：</p> <ul><li>HTTP 头信息的Content-Security-Policy的字段</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token operator">:</span> script<span class="token operator">-</span>src <span class="token string">'self'</span><span class="token punctuation">;</span> object<span class="token operator">-</span>src <span class="token string">'none'</span><span class="token punctuation">;</span>style<span class="token operator">-</span>src cdn<span class="token punctuation">.</span>example<span class="token punctuation">.</span>org third<span class="token operator">-</span>party<span class="token punctuation">.</span>org<span class="token punctuation">;</span> child<span class="token operator">-</span>src https<span class="token operator">:</span>
</code></pre></div><ul><li>通过网页的<meta>标签</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 上面代码中，CSP 做了如下配置: --&gt;</span>
<span class="token comment">&lt;!-- 脚本：只信任当前域名
object标签：不信任任何URL，即不加载任何资源
样式表：只信任cdn.example.org和third-party.org
框架（frame）：必须使用HTTPS协议加载
其他资源：没有限制 --&gt;</span>
<span class="token comment">&lt;!-- 启用后，不符合 CSP 的外部资源就会被阻止加载 --&gt;</span>
</code></pre></div></li> <li><p>4、限制选项【CSP 提供了很多限制选项，涉及安全的各个方面】</p> <ul><li><p>资源加载限制
script-src：外部脚本
style-src：样式表
img-src：图像
media-src：媒体文件（音频和视频）
font-src：字体文件
object-src：插件（比如 Flash）
child-src：框架
frame-ancestors：嵌入的外部资源（比如<frame>、<iframe>、<embed>和<applet>）
connect-src：HTTP 连接（通过 XHR、WebSockets、EventSource等）
worker-src：worker脚本
manifest-src：manifest 文件</applet></iframe></p></li> <li><p>default-src用来设置上面各个选项的默认值</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 限制所有的外部资源，都只能从当前域名加载 --&gt;</span>
<span class="token comment">&lt;!-- 如果同时设置某个单项限制（比如font-src）和default-src，前者会覆盖后者，即字体文件会采用font-src的值，其他资源依然采用default-src的值 --&gt;</span>
Content-Security-Policy: default-src 'self'
</code></pre></div></li> <li><p>URL 限制
frame-ancestors：限制嵌入框架的网页
base-uri：限制 base#href
form-action：限制 form#action</p></li> <li><p>其他限制
block-all-mixed-content：HTTPS 网页不得加载 HTTP 资源（浏览器已经默认开启）
upgrade-insecure-requests：自动将网页上所有加载外部资源的 HTTP 链接换成 HTTPS 协议
plugin-types：限制可以使用的插件格式
sandbox：浏览器行为的限制，比如不能有弹出窗口等。</p></li> <li><p>report-uri（有时，我们不仅希望防止 XSS，还希望记录此类行为。report-uri就用来告诉浏览器，应该把注入行为报告给哪个网址）</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 将注入行为报告给/my_amazing_csp_report_parser这个 URL,浏览器会使用POST方法，发送一个JSON对象 --&gt;</span>
Content-Security-Policy: default-src 'self'; ...; report-uri /my_amazing_csp_report_parser;
</code></pre></div></li></ul></li> <li><p>5、Content-Security-Policy-Report-Only</p> <p>除了Content-Security-Policy，还有一个Content-Security-Policy-Report-Only字段，表示不执行限制选项，只是记录违反限制的行为。</p> <p>它必须与report-uri选项配合使用：
Content-Security-Policy-Report-Only: default-src 'self'; ...; report-uri /my_amazing_csp_report_parser;</p></li> <li><p>6、选项值</p></li> <li><p>每个限制选项可以设置以下几种值，这些值就构成了白名单：</p></li></ul> <p>主机名：example.org，https://example.com:443
路径名：example.org/resources/js/
通配符：<em>.example.org，</em>😕/<em>.example.com:</em>（表示任意协议、任意子域名、任意端口）
协议名：https:、data:
关键字'self'：当前域名，需要加引号
关键字'none'：禁止加载任何外部资源，需要加引号</p> <ul><li>多个值也可以并列，用空格分隔</li></ul> <p>Content-Security-Policy: script-src 'self' https://apis.google.com</p> <ul><li>如果同一个限制选项使用多次，只有第一次会生效</li></ul> <p>错误的写法
script-src https://host1.com; script-src https://host2.com</p> <p>正确的写法
script-src https://host1.com https://host2.com</p> <ul><li><p>如果不设置某个限制选项，就是默认允许任何值</p></li> <li><p>6、script-src 的特殊值</p></li> <li><p>除了常规值，script-src还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。</p></li></ul> <p>'unsafe-inline'：允许执行页面内嵌的&lt;script&gt;标签和事件监听函数
unsafe-eval：允许将字符串当作代码执行，比如使用eval、setTimeout、setInterval和Function等函数。
nonce值：每次HTTP回应给出一个授权token，页面内嵌脚本必须有这个token，才会执行
hash值：列出允许执行的脚本代码的Hash值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。</p> <ul><li>nonce值的例子如下，服务器发送网页的时候，告诉浏览器一个随机生成的token，页面内嵌脚本，必须有这个token才能执行</li></ul> <p>Content-Security-Policy: script-src 'nonce-EDNnf03nceIOfn39fn3e9h3sdfa'</p> <ul><li>hash值的例子如下，服务器给出一个允许执行的代码的hash值，下面的代码就会允许执行，因为hash值相符,注意，计算hash值的时候，script标签不算在内。除了script-src选项，nonce值和hash值还可以用在style-src选项，控制页面内嵌的样式表。</li></ul> <p>Content-Security-Policy: script-src 'sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng='
<code>&lt;script&gt;alert('Hello, world.');&lt;/script&gt;</code></p> <ul><li>7、注意点</li></ul> <p>（1）script-src和object-src是必设的，除非设置了default-src。</p> <p>因为攻击者只要能注入脚本，其他限制都可以规避。而object-src必设是因为 Flash 里面可以执行外部脚本。</p> <p>（2）script-src不能使用unsafe-inline关键字（除非伴随一个nonce值），也不能允许设置data:URL。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 下面是两个恶意攻击的例子。 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data:text/javascript,evil()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>（3）必须特别注意 JSONP 的回调函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 代码中，虽然加载的脚本来自当前域名，但是通过改写回调函数，攻击者依然可以执行恶意代码。</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;/path/jsonp?callback=alert(document.domain)//&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer">Content Security Policy 入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.alloyteam.com/2021/01/sri/" target="_blank" rel="noopener noreferrer">提高资源的安全性 – SRI 与 CSP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>参考：</p> <ul><li><a href="https://segmentfault.com/a/1190000037657222" target="_blank" rel="noopener noreferrer">前端安全编码规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/foreverwaiting/easy-bookmark/edit/master/docs/blogs/safe.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/23/2021, 11:55:27 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/easy-bookmark/blogs/react.html" class="prev">
        react 学习
      </a></span> <span class="next"><a href="/easy-bookmark/blogs/vue.html">
        vue
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/easy-bookmark/assets/js/app.98929521.js" defer></script><script src="/easy-bookmark/assets/js/2.6ed84ef8.js" defer></script><script src="/easy-bookmark/assets/js/20.469dd230.js" defer></script>
  </body>
</html>
